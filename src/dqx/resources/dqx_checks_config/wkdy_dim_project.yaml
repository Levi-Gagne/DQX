# wkdy_dim_project.yaml

# 1) Enforce uniqueness of project_key across the table
- table_name: de_prd.gold.wkdy_dim_project
  name: project_key_is_not_unique
  criticality: error
  run_config_name: default
  check:
    function: is_unique
    arguments:
      columns: [project_key]

# 2) project_key must not be null
- table_name: de_prd.gold.wkdy_dim_project
  name: project_key_is_null
  criticality: error
  run_config_name: default
  check:
    function: is_not_null
    arguments:
      column: project_key

# 3) project_status must not be null
- table_name: de_prd.gold.wkdy_dim_project
  name: project_status_is_null
  criticality: error
  run_config_name: default
  check:
    function: is_not_null
    arguments:
      column: project_status

# 4) project_status must be one of the allowed values
- table_name: de_prd.gold.wkdy_dim_project
  name: project_status_is_new_value
  criticality: error
  run_config_name: default
  check:
    function: is_in_list
    arguments:
      column: project_status
      allowed:
        - Active
        - Closed
        - Pending Close
        - Schedule Pending
        - Suspended

# 5) project_type_name must be present and not 'Unknown'
- table_name: de_prd.gold.wkdy_dim_project
  name: project_type_is_not_null_or_unknown
  criticality: error
  run_config_name: default
  check:
    function: sql_expression
    arguments:
      expression: "project_type_name is not null AND project_type_name != 'Unknown'"

# COMMETED OUT: 'email' is not a valid column in wkdy_dim_project
#- name: email_is_not_valid
#  criticality: error
#  run_config_name: default
#  check:
#    function: regex_match
#    arguments:
#      column: email
#      regex: "^(.+)@(.+)$"

# 6) start_date must be <= end_date (with wide defaults)
- table_name: de_prd.gold.wkdy_dim_project
  name: project_start_after_end_date
  criticality: error
  run_config_name: default
  check:
    function: sql_expression
    arguments:
      expression: "coalesce(project_start_date, '1900-01-01') <= coalesce(project_end_date, '9999-12-31')"

# 7) first_activity_date must be <= last_activity_date (with wide defaults)
- table_name: de_prd.gold.wkdy_dim_project
  name: first_activity_date_after_last_activity_date
  criticality: error
  run_config_name: default
  check:
    function: sql_expression
    arguments:
      expression: "coalesce(first_activity_date, '1900-01-01') <= coalesce(last_activity_date, '9999-12-31')"

# 8) _created_date must be <= _last_updated_date (with wide defaults)
- table_name: de_prd.gold.wkdy_dim_project
  name: created_date_after_last_updated_date
  criticality: error
  run_config_name: default
  check:
    function: sql_expression
    arguments:
      expression: "coalesce(_created_date, '1900-01-01') <= coalesce(_last_updated_date, '9999-12-31')"